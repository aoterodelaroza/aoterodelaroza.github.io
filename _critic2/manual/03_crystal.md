---
layout: single
title: "Reading a crystal structure"
permalink: /critic2/manual/crystal/
excerpt: "Reading a crystal structure in critic2."
sidebar:
  nav: "critic2_manual"
toc: true
toc_label: "Reading a crystal structure"
toc_sticky: true
---

## Loading a crystal structure (CRYSTAL) {#c2-crystal}

~~~
CRYSTAL file.cif [datablock.s]
CRYSTAL file.res
CRYSTAL file.ins
CRYSTAL file.cube
CRYSTAL file.bincube
CRYSTAL file.struct
CRYSTAL [file.]{POSCAR,CONTCAR,CHGCAR,CHG,ELFCAR,AECCAR0,
                AECCAR2} [at1.s at2.s ...|POTCAR]
CRYSTAL file_{DEN|PAWDEN|ELF|ELF|POT|VHA|VHXC|VXC|GDEN1|
              GDEN2|GDEN3|LDEN|KDEN}
CRYSTAL file.OUT # elk's GEOMETRY.OUT
CRYSTAL file.out [istruct.i] # ESPRESSO's PW output, file.scf.out
CRYSTAL file.out # crystal's output file.out
CRYSTAL file.in  # ESPRESSO's PW input, file.scf.in
CRYSTAL file.STRUCT_IN
CRYSTAL file.STRUCT_OUT
CRYSTAL file.gen
CRYSTAL file.xsf
CRYSTAL file.pwc
CRYSTAL
  SPG spg.s
  SPGR spg.s
  CELL a.r b.r c.r alpha.r beta.r gamma.r
  CARTESIAN [scal.r]
    # comment
    [BOHR|AU]
    [ANGSTROM|ANG]
    x1.r y1.r z1.r
    x2.r y2.r z2.r
    x3.r y3.r z3.r
  ENDCARTESIAN|END
  NEQ x.r y.r z.r at.s [ANG|ANGSTROM] [BOHR|AU]
  atom.s x.r y.r z.r [ANG/ANGSTROM] [BOHR/AU]
  atnumber.i x.r y.r z.r [ANG/ANGSTROM] [BOHR/AU]
  SYMM exprx.s, epxry.s, exprz.s
ENDCRYSTAL|END
CRYSTAL LIBRARY label.s
~~~
The first line of a critic2 input usually specifies the
structure. Critic2 can read a large number of crystal structure
formats. In the simplest usage, critic2 reads one of common file
formats like, for instance, a cif file. This is done by using:
~~~
CRYSTAL file.s
~~~
The extension of file.s is used to determine the appropriate reading
format. At present, critic2 understands cif files (extension .cif),
Gaussian cube files (.cube), critic2 binary cube files (.bincube),
WIEN2k's struct files (.struct), abinit density files (_DEN and
_PAWDEN), abinit files containing other scalar fields (_ELF,_LDEN,
etc.), elk's GEOMETRY.OUT (the .OUT extension is used, regardless of
whether the file name is GEOMETRY.OUT or not), Quantum ESPRESSO's pw.x
output (.out), Quantum ESPRESSO's pw.x input (.in), crystal's output
(.out), VASP's POSCAR, CONTCAR, CHGCAR, ELFCAR, AECCAR0, AECCAR2, and
CHG, siesta's STRUCT_IN (input) and STRUCT_OUT (generated by the
calculation), DFTB+'s gen files, xcrysden's xsf files, Quantum
ESPRESSO's pwc files, molecular xyz files, Gaussian's wfn, wfx, log,
and fchk files, and molden-style files.

The MOLECULE keyword can be used as a replacement for CRYSTAL in the
entries above. It is used when the structure correspond to a molecular
systems. For instance, cube files calculated with Gaussian (e.g. with
cubegen) can be used in critic2. See the `The molecular structure`_
section for more details.

The default distance units in the rest of the input and in the output
when CRYSTAL is used are atomic units (bohr). See `Input and output
units`_. 

A simple example of CRYSTAL input and the corresponding output
generated by critic2 is given in `Input and output for a simple
crystal structure`_.

### Cube files (cube, bincube)

Gaussian cube files read using CRYSTAL are assumed to represent a
periodic system. For molecular cube files, see section `The molecular
structure`_. This format is used, for instance, by Quantum
ESPRESSO. 

Despite their name, cube files may be used to represent non-orthogonal
cells, and have become a de facto standard. They can be written by a
lot of popular solid-state programs, so it is a good choice if critic2
provides no native interface to the densities written in the native
format of your program.

Critic2 can be used to convert cube files to binary format in order to
save disk space and reading/writing time. Binary cube files have
extension .bincube, and contain essentially the same information as a
usual cube file.

### WIEN2k (struct)

The structure of a crystal in WIEN2k is written to a file with
extension .struct. WIEN2k's struct files may or may not contain the
symmetry operations (for instance, if they have been generated by the
web interface but not run). 

### VASP (POSCAR, CONTCAR, CHGCAR, CHG, AECCAR0, AECCAR2, ELFCAR)

In VASP, the crystal structure can be read from a number of files,
including the POSCAR (recommended), the CONTCAR, the CHGCAR, and
others. Depending on the version, VASP's POSCAR and CONTCAR (and also
the rest) may be missing the atomic symbols. In that case, they need
to be provided by hand after the file name, either using a list of
atomic symbols or the location of the POTCAR. Files that contain the
word POSCAR, CONTCAR, CHG, CHGCAR, AECCAR0, AECCAR2, and ELFCAR are
also accepted (e.g. nacl.POSCAR or POSCAR_nacl). Note that the
pseudopotential charges (ZPSP, see `Atomic charge options`_) are NOT
read from the POTCAR.

### Elk (OUT)

In elk, the geometry is written to the GEOMETRY.OUT file. Any file
with extension .OUT will be assumed to be in elk's GEOMETRY.OUT format
(even though it may not be called GEOMETRY.OUT). The atomic numbers
are inferred from the name of the species file. The atomic names are
the symbols for those atomic numbers, with an integer suffix that
corresponds to the species file for that atom (first file = 1, second
file = 2, and so on).

### Quantum ESPRESSO (scf.in, scf.out)

In addition to reading Gaussian cube files generated by Quantum
ESPRESSO, the outputs (extension .scf.out) and inputs (.scf.in) of
pw.x are also understood by critic2.

If an output (file.scf.out, butonly the .out extension is detected) is
used, the block at the beginning of the output is read (from 'Title:'
... to 'Cartesian axes'). By default, the last geometry in the file is
read. If the optional istruct.i integer is given, then read the
structure with that number (only for geometry optimization jobs)

For Quantum ESPRESSO inputs (file.scf.in), only the .in extension is
detected.

### Crystal (out)

Crystal outputs can be read using the extension out. Critic2 will
automatically detect whether the file is a crystal or a Quantum
ESPRESSO output (which have the same "out" extension). Currently, only
periodic crystals are supported (no SLAB, POLYMER or MOLECULE). In
addition, this module has been tested for crystal06 and crystal14
only. 

### CIF files (cif)

CIF files are the standard format for crystal structures in the
crystallography community. The standard is published by the
International Univon for Crystallography (the core CIF dictionary).
In critic2, CIF files are read using the ciftbx library by Sydney
R. Hall. If the CIF file provides the crystal symmetry, they are
read and used. 

CIF files can contain multiple structures in "data blocks". The
specific data block to read from a multi-block cif file can be
specified with the optional argument datablock.s. For instance, to
read the data_shelx block, use datablock.s = "shelx". If datablock.s
is not present, then the first block is read.

### SHELX res and ins files (res, ins)

RES and INS files are generated and used by SHELX (and derivatives), a
program for the interpretation of experimental single-crystal X-ray
and neutron diffraction data. The INS (input) and RES (output) file
format specifications are almost identical, and can be found in the
SHELXL website. 

### Abinit (DEN, PAWDEN, ELF, LDEN, etc.)

Abinit density files (with suffix "_DEN") and PAW valence density
files ("_PAWDEN") are binary files that, in addition to the electron
density grid, contain the structural information for the crystal. In
addition, other fields also generated by abinit (in the same format)
can be read, including the electron localization function (prtelf,
_ELF suffix), the Laplacian of the electron density (prtlden, _LDEN),
the exchange-correlation potentiatl (prtvxc, _VXC), the kinetic energy
density (usekden, prtkden, _KDEN), the Hartree potential (prtvha,
_VHA), the Hartree plus xc potential (prtvhxc, _VHXC), and the total
potential (prtpot, _POT).

### SIESTA (STRUCT_IN and STRUCT_OUT)

The structure file generated by siesta has extension STRUCT_OUT. In
addition, the STRUCT_IN file (which has the same format) can be used
to restart SIESTA calculations.

### Xcrysden (xsf)

Xcrysden generates scalar field files with extension xsf, which also
contain the crystal structure. If the xsf contains a crystal
structure, the PRIMVEC and PRIMCOORD cards are read - everything else
is ignored.

### Quantum ESPRESSO wavefunction (pwc)

This file is generated by the pw2critic.x utility in the PP bundle of
Quantum ESPRESSO. The pwc file contains the structural information for
the system as well as the k-point information and the converged
Kohn-Sham states. It is mostly used in the calculation of
delocalization indices in periodic solids.

### DFTB+ (gen)

DFTB+ reads and generates structures in the gen format. The gen format
can be read using the GenFormat driver in Geometry. It is also written
during geometry optimizations using OutputPrefix in Driver. The gen
format can be used for crystals (in which case it should contain the
lattice vectors at the end of the file) or molecules.

### Manual specification of the crystal structure (CRYSTAL environment)

The crystal structure can be specified by hand using the CRYSTAL
environment. For instance, the input for magnesium oxide (rocksalt
structure) would be:
~~~
CRYSTAL
  SPG F m -3 m
  CELL 4.213 4.213 4.213 90 90 90 ANG
  NEQ 0. 0. 0. Mg
  NEQ 1/2 1/2 1/2 O
ENDCRYSTAL
~~~
There are several relevant keywords in the CRYSTAL environment. A
particular space group can be used with the SPG keyword, in which case
only the atoms in the asymmetric unit need to be given:
~~~
SPG spg.s
~~~
The SPG keyword builds the complete set of symmetry operations in the
crystal from the space group label alone. The space group names known
to critic2 correspond to those given in the International Tables for
Crystallography vol. A, in the Hermann-Mauguin notation. Each element
in the label is separated by one or more blanks, and the input is case
insensitive. Examples of values for spg.s are "F m -3 m", "P b a 2",
"P 1 n 1", "P 63 m c" (without the quotes).

If two origin choices are possible, then an additional token "1" or
"2" can be appended to the space group label to choose between
them. If no origin choice is specified, origin 1 is used by default
(note that in most electronic structure programs, origin 2 is
default, however). For example: "F d d d 1" (F d d d with origin
choice 1), "F d d d 2" (same group with origin choice 2), "F d d d"
(same as origin 1).

For R space groups, hexagonal and rhombohedral axes are
possible. These can be specified by an "h" or "r" token after the
space group label. If no "h" or "r" is given, hexagonal axes are
used. For the hexagonal, the obverse cell is used: (0 0 0),
(1/3,2/3,2/3), and (2/3,1/3,1/3). For instance, "R 3 h" (hexagonal
axes), "R 3 r" (rhombohedral axes), "R 3" (same as "R 3 h").

For monoclinic groups, when several unique axis choices (where all
have the same label), the tokens "b" and "c" choose between the
unique axis b and c respectively. By default, the b unique axis is
used. Example: "P 2 b" (unique axis b, same as "P 1 2 1"), "P 2 c"
(unique axis c, same as "P 1 1 2"), "P 2" (same as "P 2 b" and "P 1 2
1").

The space group label can also be given as a single word without
spaces. For instance, "Fm-3m" is the same as "F m -3 m". The space
group number can be used as well, in which case all defaults for
origin choice, unique axis and hexagonal/rhombohedral axes
apply. Example: "222" is equivalent to "Pn-3n", "Pn-3n1", and "P n -3
n 1".

If the space group is not one of the standard settings (for instance,
"A 2/n", also written as "A 1 2/n 1"), then the routines from the SPGR
library are used. These routines can be accessed direclty by using the
SPGR keyword instead of SPG:
~~~
SPGR spg.s
~~~
Even though the interpretation of the space group symbol is done by a
different library, the result is the same: establishing the symmetry
operations for the crystal.

The notation for SPGR is slightly different and provides more
flexibility than SPG (although space group numbers can not be
used). The space group label in SPGR follows these conventions: 

- Input space group symbol using the international Hermann-Mauguin
  notation for the operations.

- Each different symmetry element must be separated by a blank.

- Characters in a symmetry element must be given as a single
  word. This is also the case for subindices.

- Upperscore is represented by - preceding the symmetry operation.

- Case is irrelevant.

Examples of space groups for SPGR are "F m -3 m", "P 21 21 21", "A 1
21/n 1", "P 4/m m m", and "R -3 c".

If no SPG or SPGR keyword is found in the CRYSTAL environment, then an
internal routine calculates the symmetry from the atomic positions
(which can be deactivated using NOSYMM, see `Symmetry options`_). In
this case, all the atoms in the cell need to be given (in contrast to
using SPG, in which case only the asymmetric unit needs to be
given). There are two possible ways to input the cell parameters. In
the simplest approach, the CELL keyword can be used to give the cell
lengths and angles:
~~~
CELL a.r b.r c.r alpha.r beta.r gamma.r [ANG/ANGSTROM/BOHR/AU]
~~~
If the ANG (or ANGSTROM) keyword is used, then a.r, b.r and c.r are in
angstrom. Otherwise, cell parameters are in bohr by default (the
keyword BOHR or AU can be used, but it is redundant). Using the CELL
keyword lets critic2 decide on the crystallographic-to-Cartesian
transformation matrix (which is not unique; critic2 always uses the
Cholesky decomposition of the metric tensor, for
consistency). Alternatively, one could input this matrix using the
CARTESIAN keyword:
~~~
CARTESIAN [scal.r]
  # comment
  [BOHR/AU]
  [ANGSTROM/ANG]
  x1.r y1.r z1.r
  x2.r y2.r z2.r
  x3.r y3.r z3.r
ENDCARTESIAN/END
~~~
CARTESIAN reads the Cartesian coordinates of the cell vectors in some
arbitrary orthonormal reference frame. Each row corresponds to a
vector (hence the metric tensor is G = R * R' where R is the matrix
above and ' is the transpose, and the coordinate transformation is
(cryst) = (cart) * R). If scal.r is given, all vectors are scaled by
that factor. The input units are bohr by default. The default can be
changed with a previous UNITS command or with the BOHR/AU and
ANG/ANGSTROM keywords inside the CARTESIAN environment.

The CARTESIAN keyword is particularly useful for inputs based on
Quantum ESPRESSO results since the matrix corresponds exactly to the
CELL_PARAMETERS matrix, and scal.r can be set to celldm(1).

The NEQ keyword can be used to specify the atomic
positions. Equivalently, one can start the line with the atomic symbol
or the atomic number:
~~~
NEQ x.r y.r z.r at.s [ANG/ANGSTROM] [BOHR/AU]
atom.s x.r y.r z.r [ANG/ANGSTROM] [BOHR/AU]
atnumber.i x.r y.r z.r [ANG/ANGSTROM] [BOHR/AU]
~~~
NEQ adds one atom to the crystal. If symmetry is used (via SPG or
SYMM), then only the non-equivalent atom list needs to be given (as in
the MgO example above), which decreases the number of NEQs that are
necessary. Otherwise, the complete list of atoms in the cell has to be
indicated, and the symmetry guess will reduce it to the non-equivalent
atoms list. The coordinates x.r y.r z.r are crystallographic
(fractional) coordinates unless the ANG/ANGSTROM or BOHR/AU keywords
are used. Usage of Cartesian coordinates requires a previous CELL or
CARTESIAN command in order to convert the atomic positions to
crystallographic coordinates. The atomic symbol is at.s, and the
atomic number is detected from the symbol (essentially, from the
beginning of it, so atoms like Cl1 or baxx2 are valid). Deuterium (D)
is detected as hydrogen.

The list of atomic positions can be extended by symmetry operations
specified using the SYMM keyword. The SYMM keyword accepts three
arithmetic expressions separated by commas. These expressions contain
the variables x, y, and z (case insensitive), and represent symmetry
operations in crystallographic coordinates. For instance:
~~~
SYMM -X+1/2, Y+1/2, -Z+1/2
~~~
would apply that operation to all atoms in the NEQ. If they are
different from the original, the new atoms are added to the list. This
keyword is useful in cases when it is difficult to pass SPG a certain
non-standard setting for a low-symmetry space group, or when the
space group symmetry is given in this format instead of a space group
label (e.g. cif files and SHELX res files).

### The crystal library (CRYSTAL LIBRARY) {#c2-library}

A library of (simple) crystal structures is provided with critic2, and
can be accessed using the CRYSTAL LIBRARY keyword:
~~~
CRYSTAL LIBRARY NaCl
~~~
Critic2 tries to find the "NaCl" label (case-insensitive) in an
internal library file that is distributed with the code, and usually
located in dat/crystal.dat relative to the source of the
distribution. The relevant library entry in this case reads:
~~~
STRUCTURE B1 rock_salt rocksalt NaCl
  CRYSTAL
    SPG f m -3 m
    CELL 5.6402 5.6402 5.6402 90 90 90 ANG
    NEQ 0.0 0.0 0.0 na
    NEQ 0.5 0.5 0.5 cl
  ENDCRYSTAL
ENDSTRUCTURE
~~~
Note the four aliases (B1, rock_salt, rocksalt, and NaCl) that are
defined for the same crystal structure. The syntax in the CRYSTAL
environment is exactly the same as above.  The user can define their
own library of crystal structures either by modifying the crystal.dat
directly or by using the LIBRARY keyword:
~~~
LIBRARY CRYSTAL /path/to/library
~~~
where the indicated file is used instead to perform the lookup. The
path can be absolute or relative to the execution directory.

A similar library exists for molecules (molecule.dat) that can be
accessed throught the MOLECULE keyword. See `The molecular
structure`_.   

## Symmetry options {#c2-symm}

Critic2 has two symmetry modules: "spg" and "spglib". Spg accepts a
label (for instance, "P m -3 m") and builds the symmetry from
it. Spglib is a library by Atsushi Togo
(atztogo.github.io/spglib). Spglib reads the unit cell description
(lengths, angles, and the complete list of atoms in the cell) and
calculates all the symmetry operations. Spglib is always used,
regardless of whether the symmetry information is read from the
structure file (e.g. SPG keyword in CRYSTAL, or a cif file) or not. If
the system is big or the use of symmetry is specifically deactivated
(for instance if the crystal is too big), then the symmetry operations
from the external source will be used, if available.

The treatment of symmetry in critic2 can be controlled using the
SYMM/NOSYMM (before CRYSTAL) and CLEARSYM (after CRYSTAL) keywords.
~~~
SYM|SYMM [-1|0|1]
NOSYMM|NOSYM
~~~
Activates (SYM or SYMM) or deactivates (NOSYMM or NOSYM) the use of
symmetry. These keywords must be used before CRYSTAL to be effective,
and they have no effect on MOLECULE (molecules never use
symmetry). The four options to SYMM are: 0, no symmetry (same as
NOSYMM); 1, full symmetry; -1, use full symmetry only if the system is
small (<= 5000 atoms). The default is -1.
~~~
SYMPREC symprec.r
~~~
Sets the precision for the spglib symmetry module (default: 1d-4).
~~~
CLEARSYM
~~~
Clear all symmetry operations (that is, use space group P 1). It must
be used after CRYSTAL to be effective.

## Atomic charge options {#c2-charge}

The Q (or QAT) and ZPSP keywords can be used to change the atomic
charge and pseudopotential charge after CRYSTAL:
~~~
{Q|QAT} at1.s q1.r [at2.s q2.r] ...
ZPSP at1.s q1.r [at2.s q2.r] ...
~~~
This command changes the atomic charge (Q, QAT) or the pseudopotential
charge (ZPSP) of the atomic species at1.s, at2.s,.... Real numbers for
the charges and ZPSP are acceptable; the latter are internally
converted to integers.

Q is used to calculate the point-charge electrostatic energy (using
Ewald's method, see `Other structural tools (NEWCELL, ENVIRON,
PACKING, IDENTIFY, EWALD)`_).

The role of ZPSP is to augment the fields defined on a grid, a
procedure called core augmentation. ZPSP is the pseudopotential
charge, that is, the atomic number of the atom minus the number of
electrons represented by the pseudopotential. For instance, ZPSP=2 is
a usual value for Ba. A typical way to use grids in critic2 involves
loading the valence density or pseudo-density and augmenting it to an
all-electron density that has maxima at the nuclear positions, which
is important for certain applications (for instance, plotting).  While
this procedure is not entirely satisfactory from the theoretical point
of view, in practice, the valence regions are mostly unaffected. Of
course, core augmentation needs not be used if the field is not the
electron density or if the grid already contains the core
contributions, and it is usually better to use the full all-electron
density from the electronic structure code, if it is able to generate
it.

Core augmentation is not activated by default, even if the ZPSP
keyword is used (see CORE in `Additional LOAD options`_). The use of
ZPSP as above sets the pseudopotential charges for all current fields;
particular ZPSP values for certain fields can also be given using
LOAD. In a VASP calculation, the value of ZPSP can be found easily by
grepping 'ZVAL' in the POTCAR file. In Quantum ESPRESSO, this
information is in the UPF file (the "number of valence electrons"). In
abinit, it can be found in the pseudopotential files.

The keyword NOCORE clears the ZPSP values of all atoms in all fields:
~~~
NOCORE
~~~

## Loading multiple crystal structures {#c2-reset}

Critic2 can only work with one structure at a given time. However,
more than one crystal can be loaded in the same run, simply by giving
a new CRYSTAL (or MOLECULE) keyword. When the second and subsequent
CRYSTAL/MOLECULE keywords are read, critic2 clears all the information
for the previous structure, including the structural data (cell
parameters, atomic positions, etc.) as well as all the fields that had
been loaded, all the critical point information, and the atomic and
core density grids. Effectively, critic2 behaves as if starting a new
run, except in that the variables and global options are carried
over. To clear the variables and set the global options to their
default values, use the RESET keyword:
~~~
RESET
~~~

